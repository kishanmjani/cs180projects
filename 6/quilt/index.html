<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Image Quilting</title>

    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">

    <script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js"
        integrity="sha384-0pzryjIRos8mFBWMzSSZApWtPl/5++eIfzYmTgBBmXYdhvxPc+XcFEk+zJwDgWbP"
        crossorigin="anonymous"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
    <header>
        <h1>Final Project 1: Image Quilting</h1>
        <p>Kishan Jani</p>
    </header>

    <div class="container">

        <!-- Contents -->
        <main>
            </section>
            <section id="part 2">
                <h2>Part 1: Randomly Sampled Texture</h2>
                <h3> Overview </h3>
                <p>
                    In this section, we implemented the <code>quilt_random</code> function, 
                    which generates an output image of a specified size <code>out_size</code> by randomly sampling square 
                    patches of size <code>patch_size</code> from a given texture <code>sample</code>. The function begins tiling the output 
                    image from the upper-left corner, placing randomly selected patches until the image is filled.
                    If the patches do not perfectly fit the dimensions of the output image, the remaining edges 
                    are left as black borders. 

                    While this method is straightforward and computationally efficient, it obviously produces 
                    visible seams and lacks coherence between adjacent patches, resulting in a less realistic 
                    texture.
                </p>
                <h3> Results </h3>
                <p> 
                    Below we present some examples of using the <code>quilt_random(sample, out_size, patch_size)</code>. Parameter choices 
                    are <code>out_size = 300</code> and <code>patch_size = 25</code> consistently.
                    We see that out of these textures, the only one that looks reasonably good when randomly quilted is 
                    <code>grass.jpg</code>. The explanation is simple: grass has the fewest edge artifacts and seams of all 
                    the images, hence was the easiest to quilt. This trend continues throughout the project: <strong> Textures with 
                        less dominant seams and edges are easier to quilt (and texture transfer)</strong>.
                    
                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/bricks_small.jpg" class="small">
                            <div class="caption">Initial Brick Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/random_brick.png"  class="large">
                            <div class="caption">Generated by Random Quilting</div>
                        </div>
                    </div>        
                    
                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/texture.png" class="small">
                            <div class="caption">Initial Cloth Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/random_cloth.png"  class="large">
                            <div class="caption">Generated by Random Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/grass.jpg" class="small">
                            <div class="caption">Initial Grass Texture (from Google)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/random_grass.png"  class="large">
                            <div class="caption">Generated by Random Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/water.jpg" class="small">
                            <div class="caption">Initial water Texture (from Google)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/random_water.png"  class="large">
                            <div class="caption">Generated by Random Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/text_small.jpg" class="small">
                            <div class="caption">Initial text Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/random_text.png"  class="large">
                            <div class="caption">Generated by Random Quilting</div>
                        </div>
                    </div>  
                </p>
            </section>
            

            <h2>Part 2: Resolving Overlapping Patches using SSD</h2>
                <h3> Overview </h3>
                <p>
                    <p>
                        The function <code>quilt_simple</code> generates an output image of size 
                        <code>out_size</code> by arranging patches of size <code>patch_size</code>. The process begins with a 
                        randomly selected patch for the upper-left corner. Subsequent patches are sampled to overlap with existing 
                        patches. For example:
                    </p>
                    <ul>
                        <li>The second patch along the top row overlaps horizontally by <code>overlap</code> pixels.</li>
                        <li>Patches in the first column overlap vertically by <code>overlap</code> pixels.</li>
                        <li>Other patches overlap both horizontally and vertically.</li>
                    </ul>
                    <p>
                        The cost of placing each patch is computed, and a random patch is chosen from the lowest <code>tol</code>
                        samples. This is done with two helpers:
                    </p>
                    <h4>1. <code>ssd_patch</code></h3>
                    <p>
                        This function calculates the cost of a patch using the sum of squared differences (SSD) between the 
                        overlapping regions of the existing output and the sampled patch: 
                        <pre>
                            <code>ssd_cost = ((M*T)**2).sum() 
                                       - 2 * cv2.filter2D(I, ddepth=-1, kernel=M*T) 
                                       + cv2.filter2D(I**2, ddepth=-1, kernel=M) </code>
                                </pre>
                        Here, <code>T</code> is the sampled patch, <code>M</code> is the mask, 
                                and <code>I</code> is the input texture.
                
                    <h4>2. <code>choose_sample</code></h3>
                    <p>
                        This function selects a patch based on the cost map from <code>ssd_patch</code>. It identifies patches 
                        with the lowest costs and randomly chooses one from the top <code>tol</code> smallest costs. For debugging, 
                        setting <code>tol=1</code> ensures that the patch with the absolute lowest cost is always chosen, resulting 
                        in a near-exact copy of the input texture. Higher <code>tol</code> gives more variability and stochasticity to 
                        the texture generated.
                    </p>
                
                </p>
                <h3> Results </h3>
                <p> 
                    Below we present some examples of using the <code>quilt_simple(sample, out_size, patch_size)</code>. Parameter choices 
                    are <code>out_size = 300</code> and <code>patch_size = 25</code> consistently.
                    
                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/bricks_small.jpg" class="small">
                            <div class="caption">Initial Brick Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/simple_brick.png"  class="large">
                            <div class="caption">Generated by Optimal-SSD Overlap Quilting</div>
                        </div>
                    </div>        
                    
                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/texture.png" class="small">
                            <div class="caption">Initial Cloth Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/simple_cloth.png"  class="large">
                            <div class="caption">Generated by Optimal-SSD Overlap Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/grass.jpg" class="small">
                            <div class="caption">Initial Grass Texture (from Google)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/simple_grass.png"  class="large">
                            <div class="caption">Generated by Optimal-SSD Overlap Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/water.jpg" class="small">
                            <div class="caption">Initial water Texture (from Google)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/simple_water.png"  class="large">
                            <div class="caption">Generated by Optimal-SSD Overlap Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/text_small.jpg" class="small">
                            <div class="caption">Initial text Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/simple_text.png"  class="large">
                            <div class="caption">Generated by Optimal-SSD Overlap Quilting</div>
                        </div>
                    </div>  
                </p>
            </section>

    


            
        </main>
    </div>

</body>

</html>
