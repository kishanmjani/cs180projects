<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Image Quilting</title>

    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">

    <script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js"
        integrity="sha384-0pzryjIRos8mFBWMzSSZApWtPl/5++eIfzYmTgBBmXYdhvxPc+XcFEk+zJwDgWbP"
        crossorigin="anonymous"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
    <header>
        <h1>Final Project 1: Image Quilting</h1>
        <p>Kishan Jani</p>
    </header>

    <div class="container">

        <!-- Contents -->
        <main>
            <section id="part 1">
                <h2>Part 1: Randomly Sampled Texture</h2>
                <h3> Overview </h3>
                <p>
                    In this section, we implemented the <code>quilt_random</code> function, 
                    which generates an output image of a specified size <code>out_size</code> by randomly sampling square 
                    patches of size <code>patch_size</code> from a given texture <code>sample</code>. The function begins tiling the output 
                    image from the upper-left corner, placing randomly selected patches until the image is filled.
                    If the patches do not perfectly fit the dimensions of the output image, the remaining edges 
                    are left as black borders. 

                    While this method is straightforward and computationally efficient, it obviously produces 
                    visible seams and lacks coherence between adjacent patches, resulting in a less realistic 
                    texture.
                </p>
                <h3> Results </h3>
                <p> 
                    Below we present some examples of using the <code>quilt_random(sample, out_size, patch_size)</code>. Parameter choices 
                    are <code>out_size = 300</code> and <code>patch_size = 25</code> consistently.
                    We see that out of these textures, the only one that looks reasonably good when randomly quilted is 
                    <code>grass.jpg</code>. The explanation is simple: grass has the fewest edge artifacts and seams of all 
                    the images, hence was the easiest to quilt. This trend continues throughout the project: <strong> Textures with 
                        less dominant seams and edges are easier to quilt (and texture transfer)</strong>.
                    
                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/bricks_small.jpg" class="small">
                            <div class="caption">Initial Brick Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/random_brick.png"  class="large">
                            <div class="caption">Generated by Random Quilting</div>
                        </div>
                    </div>        
                    
                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/texture.png" class="small">
                            <div class="caption">Initial Cloth Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/random_cloth.png"  class="large">
                            <div class="caption">Generated by Random Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/grass.jpg" class="small">
                            <div class="caption">Initial Grass Texture (from Google)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/random_grass.png"  class="large">
                            <div class="caption">Generated by Random Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/water.jpg" class="small">
                            <div class="caption">Initial water Texture (from Google)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/random_water.png"  class="large">
                            <div class="caption">Generated by Random Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/text_small.jpg" class="small">
                            <div class="caption">Initial text Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part1/random_text.png"  class="large">
                            <div class="caption">Generated by Random Quilting</div>
                        </div>
                    </div>  
                </p>
            </section>
            
            <section id ="part 2">
            <h2>Part 2: Resolving Overlapping Patches using SSD</h2>
                <h3> Overview </h3>
                <p>
                    <p>
                        The function <code>quilt_simple</code> generates an output image of size 
                        <code>out_size</code> by arranging patches of size <code>patch_size</code>. The process begins with a 
                        randomly selected patch for the upper-left corner. Subsequent patches are sampled to overlap with existing 
                        patches. For example:
                    </p>
                    <ul>
                        <li>The second patch along the top row overlaps horizontally by <code>overlap</code> pixels.</li>
                        <li>Patches in the first column overlap vertically by <code>overlap</code> pixels.</li>
                        <li>Other patches overlap both horizontally and vertically.</li>
                    </ul>
                    <p>
                        The cost of placing each patch is computed, and a random patch is chosen from the lowest <code>tol</code>
                        samples. This is done with two helpers:
                    </p>
                    <h4>1. <code>ssd_patch</code></h3>
                    <p>
                        This function calculates the cost of a patch using the sum of squared differences (SSD) between the 
                        overlapping regions of the existing output and the sampled patch: 
                        <pre>
                            <code>ssd_cost = ((M*T)**2).sum() - 2 * cv2.filter2D(I, ddepth=-1, kernel=M*T)
                                 + cv2.filter2D(I**2, ddepth=-1, kernel=M) </code>
                                </pre>
                        Here, <code>T</code> is the sampled patch, <code>M</code> is the mask, 
                                and <code>I</code> is the input texture.
                
                    <h4>2. <code>choose_sample</code></h3>
                    <p>
                        This function selects a patch based on the cost map from <code>ssd_patch</code>. It identifies patches 
                        with the lowest costs and randomly chooses one from the top <code>tol</code> smallest costs. For debugging, 
                        setting <code>tol=1</code> ensures that the patch with the absolute lowest cost is always chosen, resulting 
                        in a near-exact copy of the input texture. Higher <code>tol</code> gives more variability and stochasticity to 
                        the texture generated.
                    </p>
                
                </p>
                <h3> Results </h3>
                <p> 
                    Below we present some examples of using the <code>quilt_simple(sample, out_size, patch_size)</code>. Parameter choices 
                    are <code>out_size = 300</code> and <code>patch_size = 25</code> consistently.
                </p>

                <p>
                    The results show a marked improvement over the <code>quilt_random</code> approach, but some seams and artifacts 
                    remain noticeable in specific images. This is particularly apparent in textures with strong edges, such as 
                    <code>bricks_small.jpg</code> or <code>text_small.jpg</code>, where the quilting process encounters greater challenges
                     in achieving smooth transitions.
                </p>
                <p>
                    An intriguing aspect of the algorithm is how minimizing the sum of squared differences (SSD) enables it to 
                    "understand" the importance of aligning edges. High-contrast regions, like edges, act as dominant outliers under 
                    an \( L^2 \) norm and drive the matching process. For instance, in the generated texture, the seams between bricks are mostly 
                    well-aligned, reflecting the influence of SSD optimization. In contrast, an earlier bug in the code, which 
                    caused <code>ssd_patch</code> to select random invalid patches, resulted in poorly aligned seams, emphasizing 
                    the importance of proper patch selection.
                </p>
                <p>
                    While these results approach optimality, the visible seams to the naked eye 
                    highlight the limitations of this method. In the 
                    next section, introducing a minimum cut technique addresses these issues.
                </p>            
                    
                    
                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/bricks_small.jpg" class="small">
                            <div class="caption">Initial Brick Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part2/simple_brick.png"  class="large">
                            <div class="caption">Generated by Optimal-SSD Overlap Quilting</div>
                        </div>
                    </div>        
                    
                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/texture.png" class="small">
                            <div class="caption">Initial Cloth Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part2/simple_cloth.png"  class="large">
                            <div class="caption">Generated by Optimal-SSD Overlap Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/grass.jpg" class="small">
                            <div class="caption">Initial Grass Texture (from Google)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part2/simple_grass.png"  class="large">
                            <div class="caption">Generated by Optimal-SSD Overlap Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/water.jpg" class="small">
                            <div class="caption">Initial water Texture (from Google)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part2/simple_water.png"  class="large">
                            <div class="caption">Generated by Optimal-SSD Overlap Quilting</div>
                        </div>
                    </div>     

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/text_small.jpg" class="small">
                            <div class="caption">Initial text Texture (from paper)</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part2/simple_text.png"  class="large">
                            <div class="caption">Generated by Optimal-SSD Overlap Quilting</div>
                        </div>
                    </div>  
                
            </section>

            <section id ="part 3">
                <h2>Part 3: Resolving Seams using Min-Cut</h2>
                    <h3> Overview </h3>
                    <p>
                        To address the edge artifacts caused by overlapping patches, the next step incorporates seam finding into 
                        the texture synthesis process.
                        The process utilizes the <code>cut</code> function from <code>utils.py</code>, which determines the minimum-cost 
                        contiguous path from one side of a patch to the other, based on a cost map (<code>bndcost</code>). The cost 
                        of a path through each pixel is calculated as the squared differences (summed across RGB channels for color 
                        images) between the overlapping regions of the output image and the newly sampled patch. For horizontal paths 
                        (left overlaps), 
                        the function works directly, while for vertical paths (top overlaps), the transposed cost map can be used 
                        (<code>cut(bndcost.T).T</code>).
                    </p>
                    <p>
                        If a patch has both top and left overlaps, two seams must be computed—one for each overlap. The final mask 
                        is defined as the intersection of the masks generated by each seam, using <code>np.logical_and(mask1, mask2)</code>. 
                    </p>
                
                    <p>
                        To illustrate the process, we include a visualization for a selected patch, highlighting the following steps:
                    </p>
                    <ul>
                        <li><strong>(a)</strong> The two overlapping RGB portions: the patch already in the output image (template) 
                        and the newly selected patch.</li>
                        <li><strong>(b)</strong> The per-pixel SSD cost of the overlapping region, masked by the template mask.</li>
                        <li><strong>(c)</strong> The binary horizontal mask indicating which pixels are retained from the new patch 
                        versus the existing template.</li>
                        <li><strong>(d)</strong> The binary vertical mask for the same purpose, applied to the vertical seam.</li>
                        <li><strong>(e)</strong> The final combination mask created by intersecting the horizontal and vertical masks.</li>
                    </ul>
                    
                    <h3> Results </h3>

                    <p>
                        Here, we use <code>patch_size = 25</code>, <code>out_size = 600</code>, and <code>overlap = 5</code>. 
                        Following the guidelines provided in the paper, we approximately choose <code>overlap = patch_size // 5</code>. 
                        The purpose of increasing the first two parameters is to produce more visually appealing results. This ensures that any color 
                        inconsistencies (as blending is not yet applied) are less noticeable. Additionally, a larger patch size provides more patches, 
                        giving the texture pattern more flexibility to synthesize high-quality information. It also makes the individual blocks less discernible.
                      </p>
                      <p>
                        However, for the water texture, we use <code>out_size = 300</code>. This is because water lacks significant edges or 
                        abrupt color changes that might appear odd without blending from nearby regions.
                      </p>

                    <h4> Observations on the Min-cut Path </h4>

                    This ended up being a longer section than expected. To see the results and explanation 
                    for this part (which shows the min-cut path and masks), click the link. 
                    <br>
                    <a href="./3mc/index.html"> Analysis of min-cut path for image quilting.</a>
                
                    <h4> Comparison with Other Methods</h4>
                    Below are results of <code>quilt_cut</code> when compared to the other methods. 
                    Our observations from before hold: <code>quilt_random</code> barely produces cohesive texture, only 
                    doing so for images with very few edge-artifacts (i.e. images with near constant pixel value e.g. still water being 
                    the same blue consistently). While <code>quilt_simple</code> does much better and actually aligns edges together reasonably well, 
                    it still produces vertical and horizontal seams due to the square-mask chosen. Instead, what works best is choosing an irregular mask 
                    informed by the min-sdd_cost contiguous path: results with <code>quilt_cut</code> have barely visible seams and produces interesting new 
                    texture with sufficient overlap. 
                        
                    <h5> Brick </h5>
                        <div class="gallery">
                            <div class="gallery-item">
                                <img src="quilting_images/samples/bricks_small.jpg" class="small">
                                <div class="caption">Initial Brick Texture (from paper)</div>
                            </div>

                            <div class="gallery-item">
                                <img src="quilting_images/part1/random_brick.png"  class="medium">
                                <div class="caption">Generated by Random Quilting</div>
                            </div>

                            <div class="gallery-item">
                                <img src="quilting_images/part2/simple_brick.png"  class="medium">
                                <div class="caption">Generated by SSD Quilting</div>
                            </div>
                        </div>

                        <div class="gallery">     
                            <div class="gallery-item">
                                <img src="quilting_images/part3/cut_brick.png"  class="large">
                                <div class="caption">Generated by Min-cut Quilting</div>
                            </div>
                        </div>       
                        
                        <h5> Cloth </h5>

                        <div class="gallery">
                            <div class="gallery-item">
                                <img src="quilting_images/samples/texture.png" class="small">
                                <div class="caption">Initial Cloth Texture (from paper)</div>
                            </div>

                            <div class="gallery-item">
                                <img src="quilting_images/part1/random_cloth.png"  class="medium">
                                <div class="caption">Generated by Random Quilting</div>
                            </div>

                            <div class="gallery-item">
                                <img src="quilting_images/part2/simple_cloth.png"  class="medium">
                                <div class="caption">Generated by SSD Quilting</div>
                            </div>
                        </div>

                        <div class="gallery">     
                            <div class="gallery-item">
                                <img src="quilting_images/part3/cut_cloth.png"  class="large">
                                <div class="caption">Generated by Min-cut Quilting</div>
                            </div>
                        </div>    

                <h5> Grass </h5>
                <div class="gallery">
                    <div class="gallery-item">
                        <img src="quilting_images/samples/grass.jpg" class="small">
                        <div class="caption">Initial Grass Texture (from google)</div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/part1/random_grass.png"  class="medium">
                        <div class="caption">Generated by Random Quilting</div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/part2/simple_grass.png"  class="medium">
                        <div class="caption">Generated by SSD Quilting</div>
                    </div>
                </div>

                <div class="gallery">     
                    <div class="gallery-item">
                        <img src="quilting_images/part3/cut_grass.png"  class="large">
                        <div class="caption">Generated by Min-cut Quilting</div>
                    </div>
                </div>      
            <h5> Water </h5>
                        <div class="gallery">
                            <div class="gallery-item">
                                <img src="quilting_images/samples/water.jpg" class="small">
                                <div class="caption">Initial Water Texture (from google)</div>
                            </div>

                            <div class="gallery-item">
                                <img src="quilting_images/part1/random_water.png"  class="medium">
                                <div class="caption">Generated by Random Quilting</div>
                            </div>

                            <div class="gallery-item">
                                <img src="quilting_images/part2/simple_water.png"  class="medium">
                                <div class="caption">Generated by SSD Quilting</div>
                            </div>
                        </div>

                        <div class="gallery">     
                            <div class="gallery-item">
                                <img src="quilting_images/part3/cut_water.png"  class="large">
                                <div class="caption">Generated by Min-cut Quilting</div>
                            </div>
                        </div>      
                <h5> Text </h5>
                <div class="gallery">
                    <div class="gallery-item">
                        <img src="quilting_images/samples/text_small.jpg" class="small">
                        <div class="caption">Initial Text Texture (from paper)</div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/part1/random_text.png"  class="medium">
                        <div class="caption">Generated by Random Quilting</div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/part2/simple_text.png"  class="medium">
                        <div class="caption">Generated by SSD Quilting</div>
                    </div>
                </div>

                <div class="gallery">     
                    <div class="gallery-item">
                        <img src="quilting_images/part3/cut_text.png"  class="large">
                        <div class="caption">Generated by Min-cut Quilting</div>
                    </div>
                </div>    
                    
                </section>

            <section id="part 4">
                <h2>Part 4: Texture Transfer</h2>
                <h3> Overview </h3>
                <p>
                    In this section, we do texture transfer
                </p>
                <h3> Results </h3>
                <p> 
                    Below we show texture transfer. 

                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/part4/feynman_cloth.png" class="medium">
                            <div class="caption">Feynman in Cloth Texture</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part4/feynman_sand.png"  class="medium">
                            <div class="caption">Feynman in Sand Texture</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part4/feynman_toast.png"  class="medium">
                            <div class="caption">Feynman in Toast Texture</div>
                        </div>
                    </div>   
                    
                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/part4/feynman_grass.png" class="medium">
                            <div class="caption">Feynman in Grass Texture</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part4/jassi_grass.png"  class="medium">
                            <div class="caption">Jasprit Bumrah in Grass Texture</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part4/newton_water.png"  class="medium">
                            <div class="caption">Newton in Water Texture</div>
                        </div>
                    </div>        

                </p>
            </section>

            <section id="part bw">
                <h2>Bells and Whistles: Face in Toast (Image Quilting + Laplacian Blending)</h2>
                <h3> Overview </h3>
                <p>
                    Here we try to do blending and quilting. Results are mostly disappointing. We fix
                    trying to place the face of Feynman in Toast. Optimal parameters found were as follows: 
                    for quilting, we use <code>out_size = 600, patch_size = 20, overlap = 5, tol = 3</code>. For 
                    blending, we use <code> depth = 4, sigma = 2, skip = 2</code>. Here \( 0.20 \le \alpha \le 0.45 \)
                    usually suffices for naive texture transfer. 
                    
                </p>
                <h3> Texture Transfer Standard </h3>
                
                    <div class="gallery">
                        <div class="gallery-item">
                            <img src="quilting_images/samples/feynman.png" class="medium">
                            <div class="caption">Feynman</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/samples/toast.jpg"  class="medium">
                            <div class="caption">Toast</div>
                        </div>

                        <div class="gallery-item">
                            <img src="quilting_images/part4/feynman_toast.png"  class="medium">
                            <div class="caption">Standard Texture Transfer</div>
                        </div>
                    </div> 
                

                <h3> Texture Transfer with Patch-wise Blending </h3>

                <div class="gallery">
                    <div class="gallery-item">
                        <img src="quilting_images/samples/feynman.png" class="medium">
                        <div class="caption">Feynman</div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/samples/toast.jpg"  class="medium">
                        <div class="caption">Toast</div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/partbw/face_in_toast.png"  class="medium">
                        <div class="caption">Standard Texture Transfer</div>
                    </div>
                </div> 
                <h3> Texture Transfer with Patch-wise Blending and Corner Blurring </h3>

                <div class="gallery">
                    <div class="gallery-item">
                        <img src="quilting_images/samples/feynman.png" class="medium">
                        <div class="caption">Feynman</div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/samples/toast.jpg"  class="medium">
                        <div class="caption">Toast</div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/partbw/blur_face_in_toast.png"  class="medium">
                        <div class="caption">Standard Texture Transfer</div>
                    </div>
                </div> 

                <h3> Texture Transfer with overall Blending only</h3>
                <div class="gallery">
                    <div class="gallery-item">
                        <img src="quilting_images/samples/feynman.png" class="medium">
                        <div class="caption">Feynman</div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/samples/toast.jpg"  class="medium">
                        <div class="caption">Toast</div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/partbw/face.png"  class="medium">
                        <div class="caption">Texture Transferred Feynman with Mask </div>
                    </div>

                    <div class="gallery-item">
                        <img src="quilting_images/partbw/mid_face_in_toast.png"  class="medium">
                        <div class="caption">Standard Texture Transfer</div>
                    </div>
                </div> 

            </section>



            
        </main>
    </div>

</body>

</html>
